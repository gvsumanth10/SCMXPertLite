<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login | SCMXPertLite-EXF</title>
  <!-- <link rel="stylesheet" href="/static/styles.css" /> -->
  <link rel="icon" type="image/png" href="assets/Exafluence-favicon.png" />
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    /* General Body and HTML Reset */
    body, html {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Example font, choose one you like */
        background-color: #f0f2f5; /* Light grey background */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #333;

        /* Background Image Setup */
        background-image: url('assets/background_image3.jpg'); /* Adjust path as needed */
        background-size: cover; /* Covers the entire viewport */
        background-position: center; /* Centers the image */
        background-repeat: no-repeat; /* Prevents repetition */
        background-attachment: fixed; /* Fixes the background during scroll (if content overflows) */
        background-color: #f0f2f5; /* Fallback color */
    }


    /* Login Page Wrapper - Similar to signup-page */
    .login-page {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
    }

    /* Container for the two cards - Similar to signup-container */
    .login-container {
        display: flex; /* Enables flexbox for side-by-side cards */
        background-color: #fff; /* White background for the whole container */
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden; /* Ensures rounded corners are applied correctly */
        max-width: 900px; /* Adjust as needed */
        width: 100%;
    }

    /* All other form-card, illustration-card, input, button, password-input-wrapper, toggle-password styles should be generic enough to apply to both login and signup pages. */
    /* Form Card Styles */
    .form-card {
        flex: 1; /* Takes up equal space initially */
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .logo-bar {
        margin-bottom: 25px;
    }

    .logo {
        max-width: 150px; /* Adjust logo size */
        height: auto;
    }

    .form-card h2 {
        font-size: 2em;
        margin-bottom: 30px;
        color: #333;
    }

    .form-card form {
        width: 100%;
        max-width: 300px;
    }

    .form-card input[type="text"],
    .form-card input[type="email"],
    .form-card input[type="password"] {
        width: calc(100% - 20px); /* Account for padding */
        padding: 12px 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
        outline: none;
        transition: border-color 0.3s ease;
    }

    .form-card input[type="text"]:focus,
    .form-card input[type="email"]:focus,
    .form-card input[type="password"]:focus {
        border-color: #007bff; /* Example focus color */
    }

    .form-card .btn {
        width: 100%;
        padding: 12px;
        background-color: #007bff; /* Primary button color */
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .form-card .btn:hover {
        background-color: #0056b3; /* Darker shade on hover */
    }

    .form-card p {
        margin-top: 20px;
        font-size: 0.95em;
        color: #666;
    }

    .form-card p a {
        color: #007bff;
        text-decoration: none;
        font-weight: bold;
    }

    .form-card p a:hover {
        text-decoration: underline;
    }

    .message {
        margin-top: 15px;
        font-size: 0.9em;
        font-weight: bold;
    }

    /* Illustration Card Styles */
    .illustration-card {
        flex: 1; /* Takes up equal space initially */
        background: linear-gradient(to right, #007bff, #0056b3); /* Gradient background */
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: white;
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
    }

    .illustration-image {
        max-width: 80%; /* Adjust image size */
        height: auto;
        margin-bottom: 30px;
    }

    .illustration-card h2 {
        font-size: 2em;
        margin-bottom: 20px;
        line-height: 1.3;
    }

    .illustration-card p {
        font-size: 1.1em;
        line-height: 1.6;
        max-width: 400px;
    }


    /* Responsive adjustments (same as signup-container, apply to login-container as well) */
    @media (max-width: 768px) {
        .signup-container, .login-container { /* Apply to both */
            flex-direction: column; /* Stack cards vertically on smaller screens */
            max-width: 400px; /* Adjust max-width for single column layout */
        }

        .illustration-card {
            border-top-right-radius: 0; /* Remove specific border radius for stacked layout */
            border-bottom-left-radius: 12px; /* Add bottom-left radius for illustration card */
            padding: 30px;
        }

        .form-card {
            padding: 30px;
        }
    }

    .password-input-wrapper {
        position: relative;
        width: 100%;
        max-width: 300px; /* Match form input width */
        margin-bottom: 15px; /* Adjust margin as needed */
    }

    .password-input-wrapper input {
        width: calc(100% - 20px); /* Account for padding */
        padding: 12px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
        outline: none;
        transition: border-color 0.3s ease;
        padding-right: 40px; /* Make space for the toggle button */
    }

    .password-input-wrapper .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #888;
        cursor: pointer;
        font-size: 0.85em;
        padding: 5px;
        border-radius: 4px;
        transition: color 0.2s ease, background-color 0.2s ease;
    }

    .password-input-wrapper .toggle-password:hover {
        color: #007bff;
        background-color: #f0f0f0;
    }
  </style>
  </head>
<body>
  <div class="login-page">
    <div class="login-container"> <div class="form-card">
        <div class="logo-bar">
          <img src="assets/exf_company_logo.png" alt="EXF Logo" class="logo" />
        </div>

        <h2>Login to your Account</h2>
        <form id="loginForm">
          <input type="email" id="email" placeholder="Email" required />

          <div class="password-input-wrapper">
            <input type="password" id="password" placeholder="Password" required />
            <button type="button" class="toggle-password" data-target="password">Show</button>
            </div>

          <div class="g-recaptcha" data-sitekey="6LcF3lwrAAAAABmYl7n7Si7gWC2ks_eUTgkDzfjQ"></div>
          <div id="recaptcha-error" class="message" style="color: red; margin-top: 5px;"></div>

          <button type="submit" class="btn">Log In</button>
        </form>
        <p>Don't have an account? <a href="/">Sign up here</a></p>
        <div id="msg" class="message"></div>
      </div>

      <div class="illustration-card"> <img src="assets/shipment_illustration.png" alt="Delivery Illustration" class="illustration-image">
        <h2>Effortless Shipment Management</h2>
        <p>Manage your shipments with ease, from creation to delivery. Track, update, and oversee all your logistics in one intuitive platform.</p>
      </div>
    </div>
  </div>

  <script>
    // Show/Hide Password toggle
    document.querySelectorAll(".toggle-password").forEach((button) => {
      button.addEventListener("click", () => {
        const targetId = button.dataset.target;
        const passwordInput = document.getElementById(targetId);
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          button.textContent = "Hide";
          // If using Font Awesome:
          // button.classList.remove("fa-eye");
          // button.classList.add("fa-eye-slash");
        } else {
          passwordInput.type = "password";
          button.textContent = "Show";
          // If using Font Awesome:
          // button.classList.remove("fa-eye-slash");
          // button.classList.add("fa-eye");
        }
      });
    });

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const msgBox = document.getElementById("msg");
      const recaptchaErrorBox = document.getElementById("recaptcha-error");

      // Get reCAPTCHA response
      const recaptchaResponse = grecaptcha.getResponse();

      if (!recaptchaResponse) {
        recaptchaErrorBox.textContent = "Please complete the reCAPTCHA verification.";
        return;
      } else {
        recaptchaErrorBox.textContent = ""; // Clear any previous error
      }

      // Redirect if already logged in
      if (localStorage.getItem("token")) {
        window.location.href = "/dashboard"; // or wherever you route logged-in users
        return;
      }

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email,
            password,
            recaptcha_response: recaptchaResponse // Send reCAPTCHA response to backend
          }),
        });

        const data = await res.json();

        if (res.ok) {
          localStorage.setItem("token", data.access_token);
          msgBox.textContent = "Login successful! Redirecting...";
          msgBox.style.color = "green";
          setTimeout(() => {
            window.location.href = "/dashboard"; // Change if needed
          }, 1500);
        } else {
          msgBox.textContent = data.detail || "Login failed.";
          msgBox.style.color = "red";
          grecaptcha.reset(); // Reset reCAPTCHA on failed login
        }
      } catch (err) {
        console.error(err);
        msgBox.textContent = "Something went wrong.";
        msgBox.style.color = "red";
        grecaptcha.reset(); // Reset reCAPTCHA on error
      }
    });
  </script>
</body>
</html>